namespace = sw22_situation

planet_event = { # on_action trigger
	id = sw22_situation.0
	title = sw22_situation.0.name
	desc = sw22_situation.0.desc
	picture = GFX_evt_news_room
	show_sound = event_red_alert
	is_triggered_only = yes

	location = root

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
		is_occupied_flag = no
	}

	trigger = {
		NOT = { has_planet_flag = sw22_worm_attack }
		has_global_flag = sw22_fired
		has_global_flag = sw22_worm_assult_begin
	}

	immediate = {
		set_planet_flag = sw_22_worm_attack
	}

	option = {
		name = INTERESTING
		owner = {
			start_situation = {
				type = situation_worm_attack
				target = root
			}
		}
		hidden_effect = {
			planet_event = {
				id = sw22_situation.1
			}
		}
	}
}

planet_event = { # Worm Attack
	id = sw22_situation.1
	title = "sw22_situation.1.name"
	desc = "sw22_situation.1.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	location = ROOT
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
		is_occupied_flag = no
	}

	trigger = {
		has_planet_flag = worm_attack
	}

	immediate = {
		create_country = {
			name = "NAME_Attacking_Worms"
			type = faction
			effect = {
				establish_communications_no_message = root.owner
				establish_contact = { who = root.owner location = root.solar_system }
			}
		}
		create_species = {
			name = "NAME_Attack_Worms"
			class = random_non_machine
			portrait = random
			traits = random
		}
		create_army = {
			name = "NAME_attack_worms"
			owner = last_created_country
			species = last_created_species
			type = "worm_army"
		}
	}

	option = {
		name = sw22_situation.1.a
	}
}

planet_event = { # Worm Deposit
	id = sw22_situation.2
	title = "sw22_situation.2.name"
	desc = "sw22_situation.2.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	location = ROOT
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
		is_occupied_flag = no
	}

	trigger = {
		has_planet_flag = worm_attack
	}

	immediate = {
		random_list = {
			33 = { add_deposit = sw22_d_damage_1 }
			66 = { add_deposit = sw22_d_damage_2 }
			99 = { add_deposit = sw22_d_damage_3 }
		}
	}

	option = {
		name = sw22_situation.2.a
	}

}

planet_event = {  # Worm Attack + Deposit
	id = sw22_situation.3
	title = "sw22_situation.3.name"
	desc = "sw22_situation.3.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	location = ROOT
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
		is_occupied_flag = no
	}

	trigger = {
		has_planet_flag = worm_attack
	}

	immediate = {
		random_list = {
			33 = { add_deposit = sw22_d_damage_1 }
			66 = { add_deposit = sw22_d_damage_2 }
			99 = { add_deposit = sw22_d_damage_3 }
		}

		create_country = {
			name = "NAME_Attacking_Worms"
			type = faction
			effect = {
				establish_communications_no_message = root.owner
				establish_contact = { who = root.owner location = root.solar_system }
			}
		}
		create_species = {
			name = "NAME_Attack_Worms"
			class = random_non_machine
			portrait = random
			traits = random
		}
		create_army = {
			name = "NAME_attack_worms"
			owner = last_created_country
			species = last_created_species
			type = "worm_army"
		}
	}

	option = {
		name = sw22_situation.3.a
	}
}

#Lose Agaist Worm
planet_event = {  # Tomb World Time
	id = sw22_situation.4 
	title = "sw22_situation.4.name"
	desc = "sw22_situation.4.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	location = ROOT
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
		is_occupied_flag = no
	}

	trigger = {
		has_planet_flag = worm_attack
	}

	immediate = {
		change_pc = pc_nuked
		create_country = {
			name = "NAME_Attacking_Worms"
			type = faction
			effect = {
				establish_communications_no_message = root.owner
				establish_contact = { who = root.owner location = root.solar_system }
			}
		}
		create_species = {
			name = "NAME_Attack_Worms"
			class = random_non_machine
			portrait = random
			traits = random
		}
		create_army = {
			name = "NAME_attack_worms"
			owner = last_created_country
			species = last_created_species
			type = "worm_army"
		}
		create_army = {
			name = "NAME_attack_worms"
			owner = last_created_country
			species = last_created_species
			type = "worm_army"
		}
		create_army = {
			name = "NAME_attack_worms"
			owner = last_created_country
			species = last_created_species
			type = "worm_army"
		}
	}

	option = {
		name = sw22_situation.1.a
	}
}

#Worm Attack Random Events
#Wormling Army
planet_event = {
	id = sw22_situation.1.1
	title = "sw22_situation.1.1.name"
	desc = "sw22_situation.1.1.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	location = ROOT
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
		is_occupied_flag = no
	}

	trigger = {
		has_planet_flag = worm_attack
	}

	immediate = {
		create_country = {
			name = "NAME_Attacking_Worms"
			type = faction
			effect = {
				establish_communications_no_message = root.owner
				establish_contact = { who = root.owner location = root.solar_system }
			}
		}
		create_species = {
			name = "NAME_Attack_Worms"
			class = random_non_machine
			portrait = random
			traits = random
		}
		create_army = {
			name = "NAME_attack_worms"
			owner = last_created_country
			species = last_created_species
			type = "wormling_army"
		}
		create_army = {
			name = "NAME_attack_worms"
			owner = last_created_country
			species = last_created_species
			type = "wormling_army"
		}
	}
		

	option = {
		name = sw22_situation.1.1.a
	}

}

#Wormling Army x2
planet_event = {
	id = sw22_situation.1.2
	title = "sw22_situation.1.2.name"
	desc = "sw22_situation.1.2.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	location = ROOT
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
		is_occupied_flag = no
	}

	trigger = {
		has_planet_flag = worm_attack
	}

	immediate = {
		create_country = {
			name = "NAME_Attacking_Worms"
			type = faction
			effect = {
				establish_communications_no_message = root.owner
				establish_contact = { who = root.owner location = root.solar_system }
			}
		}
		create_species = {
			name = "NAME_Attack_Worms"
			class = random_non_machine
			portrait = random
			traits = random
		}
		create_army = {
			name = "NAME_attack_worms"
			owner = last_created_country
			species = last_created_species
			type = "wormling_army"
		}
		create_army = {
			name = "NAME_attack_worms"
			owner = last_created_country
			species = last_created_species
			type = "wormling_army"
		}
	}
		

	option = {
		name = sw22_situation.1.2.a
	}

}

#Eco Damage Minor
planet_event = { 
	id = sw22_situation.1.3
	title = "sw22_situation.1.3.name"
	desc = "sw22_situation.1.3.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	location = ROOT
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
		is_occupied_flag = no
	}

	trigger = {
		has_planet_flag = worm_attack
	}

	immediate = {
		random_list = {
			50 = { add_deposit = sw22_d_damage_1 }
			30 = { add_deposit = sw22_d_damage_2 }
			20 = { add_deposit = sw22_d_damage_3 }
		}
	}

	option = {
		name = sw22_situation.1.3.a
	}
}

#Eco Damage Major
planet_event = { 
	id = sw22_situation.1.4
	title = "sw22_situation.1.4.name"
	desc = "sw22_situation.1.4.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	location = ROOT
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
		is_occupied_flag = no
	}

	trigger = {
		has_planet_flag = worm_attack
	}

	immediate = {
		random_list = {
			50 = { add_deposit = sw22_d_damage_1 }
			30 = { add_deposit = sw22_d_damage_2 }
			20 = { add_deposit = sw22_d_damage_3 }
		}
		random_list = {
			50 = { add_deposit = sw22_d_damage_1 }
			30 = { add_deposit = sw22_d_damage_2 }
			20 = { add_deposit = sw22_d_damage_3 }
		}
	}

	option = {
		name = sw22_situation.1.4.a
	}
}

#Army Minor Victory
situation_event = {
	id = sw22_situation.1.5
	title = "sw22_situation.1.5.name"
	desc = "sw22_situation.1.5.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	is_triggered_only = yes
	situation = this
	location = target

	immediate = {
		add_situation_progress = -5
	}

	option = {
		name = sw22_situation.1.5.a
	}
}

#Army Major Victory
situation_event = {
	id = sw22_situation.1.6
	title = "sw22_situation.1.6.name"
	desc = "sw22_situation.1.6.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	is_triggered_only = yes
	situation = this
	location = target

	immediate = {
		add_situation_progress = -10
	}

	option = {
		name = sw22_situation.1.6.a
	}
}

#Worm Minor Victory
situation_event = {
	id = sw22_situation.1.7
	title = "sw22_situation.1.7.name"
	desc = "sw22_situation.1.7.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	is_triggered_only = yes
	situation = this
	location = target

	immediate = {
		add_situation_progress = 5
	}

	option = {
		name = sw22_situation.1.7.a
	}
}

#Worm Major Victory
situation_event = {
	id = sw22_situation.1.8
	title = "sw22_situation.1.8.name"
	desc = "sw22_situation.1.8.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	is_triggered_only = yes
	situation = this
	location = target

	immediate = {
		add_situation_progress = 10
	}

	option = {
		name = sw22_situation.1.8.a
	}
}

#Worm Dies Naturally
situation_event = {
	id = sw22_situation.1.9
	title = "sw22_situation.1.9.name"
	desc = "sw22_situation.1.9.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	is_triggered_only = yes
	situation = this
	location = target

	after = {
		destroy_situation = this
	}

	option = {
		name = sw22_situation.1.9.a
	}
}

# Seach for Molodian System Events
situation_event = {
	id = sw22_situation.2.2.1
	title = "sw22_situation.2.2.1.name"
	desc = "sw22_situation.2.2.1.desc"
	picture = GFX_evt_alien_nature
	is_triggered_only = yes
	situation = this

	immediate = {
		if = {
			limit = {
				NOR = {
					has_global_flag = sw22_molodian_system_discovered
					has_country_flag = vultaum_system
				}
			}
			country_event = { id = sw22_situation.2.2.2 }
		}
		else_if = {
			limit = {
				has_global_flag = sw22_molodian_system_discovered
			}
		}
		country_event = { id = sw22_situation.2.2.3 }
	}
	
	after = {
		destroy_situation = this
	}
	
}

country_event = {
	id = sw22_situation.2.2.2
	hide_window = yes
	fire_only_once = yes
	is_triggered_only = yes

	immediate = {
		set_global_flag = sw22_molodian_system_discovered
		set_country_flag = sw22_molodian_system

		random_system_within_border = {
			save_event_target_as = sw22_molodian_spawn_system
		}

		event_target:sw22_molodian_spawn_system = {
			spawn_system = {
				min_distance = 10
				max_distance = 30
				max_jumps = 0
				initializer = "sw22_molodian_system"
			}
		}
		if = {
			limit = { last_created_system = { NOT = { has_hyperlane_to = prev } } }
			add_hyperlane = {
				from = this
				to = last_created_system
			}
		}
		else = {
			add_extra_hyperlane_to_spawned_system_effect = yes
		}
	}
}
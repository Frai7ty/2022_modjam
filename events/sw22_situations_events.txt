namespace = sw22_situation

planet_event = { # on_action trigger
	id = sw22_situation.0
	title = sw22_situation.0.name
	desc = sw22_situation.0.desc
	picture = GFX_evt_news_room
	show_sound = event_red_alert
	is_triggered_only = yes

	location = root

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
		is_occupied_flag = no
	}

	trigger = {
		NOT = { has_planet_flag = sw22_worm_attack }
		has_global_flag = sw22_fired
		has_global_flag = sw22_worm_assult_begin
	}

	immediate = {
		set_planet_flag = sw_22_worm_attack
	}

	option = {
		name = INTERESTING
		owner = {
			start_situation = {
				type = situation_worm_attack
				target = root
			}
		}
		hidden_effect = {
			planet_event = {
				id = sw22_situation.1
			}
		}
	}
}

planet_event = { # Worm Attack
	id = sw22_situation.1
	title = "sw22_situation.1.name"
	desc = "sw22_situation.1.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	location = ROOT
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
		is_occupied_flag = no
	}

	trigger = {
		has_planet_flag = worm_attack
	}

	immediate = {
		create_country = {
			name = "NAME_Attacking_Worms"
			type = faction
			effect = {
				establish_communications_no_message = root.owner
				establish_contact = { who = root.owner location = root.solar_system }
			}
		}
		create_species = {
			name = "NAME_Attack_Worms"
			class = random_non_machine
			portrait = random
			traits = random
		}
		create_army = {
			name = "NAME_attack_worms"
			owner = last_created_country
			species = last_created_species
			type = "worm_army"
		}
	}

	option = {
		name = sw22_situation.1.a
	}
}

planet_event = { # Worm Deposit
	id = sw22_situation.2
	title = "sw22_situation.2.name"
	desc = "sw22_situation.2.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	location = ROOT
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
		is_occupied_flag = no
	}

	trigger = {
		has_planet_flag = worm_attack
	}

	immediate = {
		random_list = {
			33 = { add_deposit = sw22_d_damage_1 }
			66 = { add_deposit = sw22_d_damage_2 }
			99 = { add_deposit = sw22_d_damage_3 }
		}
	}

	option = {
		name = sw22_situation.2.a
	}

}

planet_event = {  # Worm Attack + Deposit
	id = sw22_situation.3
	title = "sw22_situation.3.name"
	desc = "sw22_situation.3.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	location = ROOT
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
		is_occupied_flag = no
	}

	trigger = {
		has_planet_flag = worm_attack
	}

	immediate = {
		random_list = {
			33 = { add_deposit = sw22_d_damage_1 }
			66 = { add_deposit = sw22_d_damage_2 }
			99 = { add_deposit = sw22_d_damage_3 }
		}

		create_country = {
			name = "NAME_Attacking_Worms"
			type = faction
			effect = {
				establish_communications_no_message = root.owner
				establish_contact = { who = root.owner location = root.solar_system }
			}
		}
		create_species = {
			name = "NAME_Attack_Worms"
			class = random_non_machine
			portrait = random
			traits = random
		}
		create_army = {
			name = "NAME_attack_worms"
			owner = last_created_country
			species = last_created_species
			type = "worm_army"
		}
	}

	option = {
		name = sw22_situation.3.a
	}
}

#Lose Agaist Worm
situation_event = {  # Tomb World Time
	id = sw22_situation.4 
	title = "sw22_situation.4.name"
	desc = "sw22_situation.4.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	location = ROOT
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
		is_occupied_flag = no
	}

	trigger = {
		has_planet_flag = worm_attack
	}

	immediate = {
		change_pc = pc_nuked
		create_country = {
			name = "NAME_Attacking_Worms"
			type = faction
			effect = {
				establish_communications_no_message = root.owner
				establish_contact = { who = root.owner location = root.solar_system }
			}
		}
	}

	option = {
		name = sw22_situation.1.a
	}
}

#Worm Attack Random Events
#Wormling Army
situation_event = {
	id = sw22_situation.11
	title = "sw22_situation.11.name"
	desc = "sw22_situation.11.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	location = ROOT
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
		is_occupied_flag = no
	}

	trigger = {
		has_planet_flag = worm_attack
	}

	immediate = {
		create_country = {
			name = "NAME_Attacking_Worms"
			type = faction
			effect = {
				establish_communications_no_message = root.owner
				establish_contact = { who = root.owner location = root.solar_system }
			}
		}
		create_species = {
			name = "NAME_Attack_Worms"
			class = random_non_machine
			portrait = random
			traits = random
		}
		create_army = {
			name = "NAME_attack_worms"
			owner = last_created_country
			species = last_created_species
			type = "wormling_army"
		}
		create_army = {
			name = "NAME_attack_worms"
			owner = last_created_country
			species = last_created_species
			type = "wormling_army"
		}
	}
		

	option = {
		name = sw22_situation.11.a
	}

}

#Wormling Army x2
situation_event = {
	id = sw22_situation.12
	title = "sw22_situation.12.name"
	desc = "sw22_situation.12.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	location = ROOT
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
		is_occupied_flag = no
	}

	trigger = {
		has_planet_flag = worm_attack
	}

	immediate = {
		create_country = {
			name = "NAME_Attacking_Worms"
			type = faction
			effect = {
				establish_communications_no_message = root.owner
				establish_contact = { who = root.owner location = root.solar_system }
			}
		}
		create_species = {
			name = "NAME_Attack_Worms"
			class = random_non_machine
			portrait = random
			traits = random
		}
		create_army = {
			name = "NAME_attack_worms"
			owner = last_created_country
			species = last_created_species
			type = "wormling_army"
		}
		create_army = {
			name = "NAME_attack_worms"
			owner = last_created_country
			species = last_created_species
			type = "wormling_army"
		}
	}
		

	option = {
		name = sw22_situation.12.a
	}

}

#Eco Damage Minor
situation_event = { 
	id = sw22_situation.13
	title = "sw22_situation.13.name"
	desc = "sw22_situation.13.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	location = ROOT
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
		is_occupied_flag = no
	}

	trigger = {
		has_planet_flag = worm_attack
	}

	immediate = {
		random_list = {
			50 = { add_deposit = sw22_d_damage_1 }
			30 = { add_deposit = sw22_d_damage_2 }
			20 = { add_deposit = sw22_d_damage_3 }
		}
	}

	option = {
		name = sw22_situation.13.a
	}
}

#Eco Damage Major
situation_event = { 
	id = sw22_situation.14
	title = "sw22_situation.14.name"
	desc = "sw22_situation.14.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	location = ROOT
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
		is_occupied_flag = no
	}

	trigger = {
		has_planet_flag = worm_attack
	}

	immediate = {
		random_list = {
			50 = { add_deposit = sw22_d_damage_1 }
			30 = { add_deposit = sw22_d_damage_2 }
			20 = { add_deposit = sw22_d_damage_3 }
		}
		random_list = {
			50 = { add_deposit = sw22_d_damage_1 }
			30 = { add_deposit = sw22_d_damage_2 }
			20 = { add_deposit = sw22_d_damage_3 }
		}
	}

	option = {
		name = sw22_situation.14.a
	}
}

#Army Minor Victory
situation_event = {
	id = sw22_situation.15
	title = "sw22_situation.15.name"
	desc = "sw22_situation.15.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	is_triggered_only = yes
	situation = this
	location = target

	immediate = {
		add_situation_progress = -5
	}

	option = {
		name = sw22_situation.15.a
	}
}

#Army Major Victory
situation_event = {
	id = sw22_situation.16
	title = "sw22_situation.16.name"
	desc = "sw22_situation.16.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	is_triggered_only = yes
	situation = this
	location = target

	immediate = {
		add_situation_progress = -10
	}

	option = {
		name = sw22_situation.16.a
	}
}

#Worm Minor Victory
situation_event = {
	id = sw22_situation.17
	title = "sw22_situation.17.name"
	desc = "sw22_situation.17.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	is_triggered_only = yes
	situation = this
	location = target

	immediate = {
		add_situation_progress = 5
	}

	option = {
		name = sw22_situation.17.a
	}
}

#Worm Major Victory
situation_event = {
	id = sw22_situation.18
	title = "sw22_situation.18.name"
	desc = "sw22_situation.18.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	is_triggered_only = yes
	situation = this
	location = target

	immediate = {
		add_situation_progress = 10
	}

	option = {
		name = sw22_situation.18.a
	}
}

#Worm Dies Naturally
situation_event = {
	id = sw22_situation.19
	title = "sw22_situation.19.name"
	desc = "sw22_situation.19.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	is_triggered_only = yes
	situation = this
	location = target

	after = {
		destroy_situation = this
	}

	option = {
		name = sw22_situation.19.a
	}
}

# Seach for Molodian System Events
# Check to see if system has been found
situation_event = {
	id = sw22_situation.221
	title = "sw22_situation.221.name"
	desc = "sw22_situation.221.desc"
	picture = GFX_evt_alien_nature
	is_triggered_only = yes
	hide_window = yes
	situation = this

	immediate = {
		if = {
			limit = {
				NOR = {
					has_global_flag = sw22_molodian_system_discovered
					has_country_flag = sw22_molodian_system
				}
			}
			country_event = { id = sw22_situation.222 }
		}
		else_if = {
			limit = {
				has_global_flag = sw22_molodian_system_discovered
			}
		}
		country_event = { id = sw22_situation.223 }
	}
	
	after = {
		destroy_situation = this
	}
	
}

# Spawn System (Found First)
country_event = {
	id = sw22_situation.222
	hide_window = yes
	fire_only_once = yes
	is_triggered_only = yes

	immediate = {
		set_global_flag = sw22_molodian_system_discovered
		set_country_flag = sw22_molodian_system

		random_system_within_border = {
			save_event_target_as = sw22_molodian_spawn_system
		}

		event_target:sw22_molodian_spawn_system = {
			spawn_system = {
				min_distance = 10
				max_distance = 30
				max_jumps = 0
				initializer = "sw22_molodian_system"
			}
		}
		if = {
			limit = { last_created_system = { NOT = { has_hyperlane_to = prev } } }
			add_hyperlane = {
				from = this
				to = last_created_system
			}
		}
		else = {
			add_extra_hyperlane_to_spawned_system_effect = yes
		}
		country_event = { id = sw22_situation.224 days = 2 }
	}
}

# System Not found First
country_event = {
	id = sw22_situation.223
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		set_country_flag = sw22_molodian_system_to_slow
		country_event = { id = sw22_situation.226 days = 2 }		
	}
}

# Molodian Homeworld Discovered
country_event = {
	id = sw22_situation.224
	title = "sw22_situation.224.name"
	desc = "sw22_situation.224.desc"
	picture = GFX_evt_federation_fleet
	fire_only_once = yes
	location = event_target:sw22_molodian_system
	

	immediate = {
		random_system = {
			limit = { has_star_flag = sw22_molodian_system }
			save_event_target_as = sw22_molodian_system
			root = { set_visited = prev }
			random_system_planet = {
				limit = { has_planet_flag = sw22_molodian_homeworld }
				save_event_target_as = sw22_molodian_homeworld
			}
		}
	}
	option = {
		name = "situation.224.a"
		begin_event_chain = {
			event_chain = "sw22_molodian_homeworld_chain"
			target = ROOT
		}
		event_target:sw22_molodian_homeworld  = {
			enable_special_project = {
				name = "SW22_MOLODIAN_HOMEWORLD_PROJECT"
				location = event_target:sw22_molodian_homeworld 
				owner = ROOT
			}
		}
	}
}

# Molodian Homeworld
ship_event = {
	id = sw22_situation.225
	title = "sw22_situation.225.name"
	desc = "sw22_situation.225.desc"
	picture = GFX_evt_archaeological_dig
	location = from

	is_triggered_only = yes

	trigger = {
		fromfrom = { has_planet_flag = sw22_molodian_homeworld }
		owner = {
			is_ai = no
			has_country_flag = sw22_molodian_system
		}
	}

	immediate = {
		owner = {
			set_country_flag = sw22_molodian_homeworld_found
			set_global_flag = sw22_molodian_homeworld_found
			if = {
				limit = { has_event_chain = "sw22_molodian_homeworld_chain" }
				end_event_chain = "sw22_molodian_homeworld_chain"
			}
		}
	}

	option ={
		name = "FASCINATING"
		owner = {
			add_relic = sw22_r_worm_mom
			large_artifact_reward = yes
			add_monthly_resource_mult = {
				resource = unity
				value = 120
				min = 240
				max = 9999
			}
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}
}

# Someone else got there first
ship_event = {
	id = sw22_situation.226
	title = "sw22_situation.226.name"

	desc = "sw22_situation.226.desc.a"

	location = from
	picture = GFX_evt_archaeological_dig

	is_triggered_only = yes

	option = {
		name = "UNFORTUNATE"
	}
}